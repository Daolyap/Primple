<UserControl x:Class="Primple.Desktop.Views.MapsView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:helix="http://helix-toolkit.org/wpf"
             mc:Ignorable="d" 
             d:DesignHeight="600" d:DesignWidth="800">
    <Grid>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="300"/>
            <ColumnDefinition Width="*"/>
        </Grid.ColumnDefinitions>

        <!-- Controls Sidebar -->
        <Border Grid.Column="0" Background="#10FFFFFF" BorderBrush="{StaticResource GlassBorderBrush}" BorderThickness="0,0,1,0" Padding="20">
            <StackPanel>
                <TextBlock Text="Map to STL" FontSize="24" FontWeight="Bold" Foreground="White" Margin="0,0,0,20"/>
                
                <!-- Search -->
                <TextBlock Text="Location" Foreground="#AAAAAA" Margin="0,0,0,5"/>
                <Grid Margin="0,0,0,15">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>
                    <TextBox x:Name="SearchBox" Style="{StaticResource GlassTextBoxStyle}" Height="35" VerticalContentAlignment="Center" KeyDown="SearchBox_KeyDown"/>
                    <Button Grid.Column="1" Content="Go" Width="40" Margin="5,0,0,0" Style="{StaticResource GlassButtonStyle}" Click="SearchButton_Click"/>
                </Grid>
                
                <TextBlock x:Name="LocationText" Text="No location selected" Foreground="{StaticResource AccentBrush}" FontWeight="SemiBold" TextWrapping="Wrap" Margin="0,0,0,15"/>

                <!-- Radius -->
                <TextBlock Text="Area Size (Radius)" Foreground="#AAAAAA" Margin="0,0,0,5"/>
                <DockPanel Margin="0,0,0,10">
                    <TextBox Text="{Binding ElementName=RadiusSlider, Path=Value, StringFormat=N0}" Width="60" DockPanel.Dock="Right" Margin="5,0,0,0" Style="{StaticResource GlassTextBoxStyle}" Height="28" FontSize="12" VerticalContentAlignment="Center"/>
                    <TextBlock Text="m" Foreground="#AAAAAA" DockPanel.Dock="Right" Margin="5,0,0,0" VerticalAlignment="Center"/>
                    <Slider x:Name="RadiusSlider" Minimum="100" Maximum="10000" Value="500" TickFrequency="100" IsSnapToTickEnabled="True"/>
                </DockPanel>

                <!-- Resolution -->
                <TextBlock Text="Resolution (Detail)" Foreground="#AAAAAA" Margin="0,0,0,5"/>
                <DockPanel Margin="0,0,0,15">
                    <TextBlock Text="{Binding ElementName=ResolutionSlider, Path=Value, StringFormat={}{0}%}" Width="40" DockPanel.Dock="Right" Margin="5,0,0,0" Foreground="White" VerticalAlignment="Center"/>
                    <Slider x:Name="ResolutionSlider" Minimum="1" Maximum="200" Value="100" TickFrequency="10" IsSnapToTickEnabled="True"/>
                </DockPanel>

                <!-- Colors & Layers -->
                <TextBlock Text="Layers &amp; Colors" Foreground="#AAAAAA" Margin="0,0,0,5"/>
                
                <Grid Margin="0,2">
                     <CheckBox x:Name="CheckBuildings" Content="Buildings" IsChecked="True" Foreground="White" VerticalAlignment="Center"/>
                     <TextBox x:Name="BuildingColorHex" Text="#FF6464" Width="90" HorizontalAlignment="Right" Style="{StaticResource GlassTextBoxStyle}" Height="28" FontSize="12"/>
                </Grid>
                
                <Grid Margin="0,2">
                     <CheckBox x:Name="CheckRoads" Content="Roads" IsChecked="True" Foreground="White" VerticalAlignment="Center"/>
                     <TextBox x:Name="RoadColorHex" Text="#323232" Width="90" HorizontalAlignment="Right" Style="{StaticResource GlassTextBoxStyle}" Height="28" FontSize="12"/>
                </Grid>

                 <Grid Margin="0,2">
                     <TextBlock Text="Base/Water" Foreground="White" VerticalAlignment="Center" Margin="20,0,0,0"/>
                     <TextBox x:Name="BaseColorHex" Text="#C8C8C8" Width="90" HorizontalAlignment="Right" Style="{StaticResource GlassTextBoxStyle}" Height="28" FontSize="12"/>
                </Grid>

                <!-- Base Shape Option -->
                <TextBlock Text="Base Shape" Foreground="#AAAAAA" Margin="0,5,0,5" FontSize="12"/>
                <ComboBox x:Name="BaseShapeCombo" SelectedIndex="0" Height="30" Style="{StaticResource GlassComboBoxStyle}" Margin="0,0,0,10">
                    <ComboBoxItem Content="Square"/>
                    <ComboBoxItem Content="Circular"/>
                </ComboBox>

                <CheckBox x:Name="Check3D" Content="3D Mode (Extruded)" IsChecked="True" Foreground="White" Margin="0,10,0,5"/>

                <CheckBox x:Name="CheckElevation" Content="Enable Elevation (Terrain)" IsChecked="False" Foreground="White" Margin="0,5,0,5">
                    <CheckBox.ToolTip>
                        <ToolTip Content="Real-world terrain data. Risks: Large areas can be slower to generate and extreme values might distort your model."/>
                    </CheckBox.ToolTip>
                </CheckBox>

                <CheckBox x:Name="CheckGroundLevel" Content="Use Ground Level Offset" IsChecked="False" Foreground="White" Margin="20,0,0,5" FontSize="11">
                    <CheckBox.ToolTip>
                        <ToolTip Content="CAUTION: If Offset is higher than the terrain, your map will be BLANK. Recommended for mountains."/>
                    </CheckBox.ToolTip>
                </CheckBox>

                <DockPanel Margin="20,0,0,10" x:Name="GroundLevelPanel" IsEnabled="{Binding ElementName=CheckGroundLevel, Path=IsChecked}">
                    <TextBox Text="{Binding ElementName=GroundLevelSlider, Path=Value, StringFormat=N0}" Width="40" DockPanel.Dock="Right" Margin="5,0,0,0" Style="{StaticResource GlassTextBoxStyle}" Height="24" FontSize="11"/>
                    <Slider x:Name="GroundLevelSlider" Minimum="-100" Maximum="5000" Value="0" TickFrequency="100"/>
                </DockPanel>

                <TextBlock Text="Foundation Depth" Foreground="#AAAAAA" Margin="0,5,0,5" FontSize="12"/>
                <DockPanel Margin="0,0,0,10">
                    <TextBox Text="{Binding ElementName=BaseThicknessSlider, Path=Value, StringFormat=N1}" Width="40" DockPanel.Dock="Right" Margin="5,0,0,0" Style="{StaticResource GlassTextBoxStyle}" Height="28" FontSize="12"/>
                    <Slider x:Name="BaseThicknessSlider" Minimum="0.5" Maximum="20.0" Value="3.0" TickFrequency="0.5" IsSnapToTickEnabled="True"/>
                </DockPanel>

                <!-- 3D Printer Settings -->
                <TextBlock Text="3D Printer Settings" Foreground="#AAAAAA" Margin="0,0,0,5" FontWeight="Bold"/>
                
                <Grid Margin="0,2">
                    <TextBlock Text="Scale" VerticalAlignment="Center" Foreground="#CCFFFFFF" FontSize="12"/>
                    <TextBox x:Name="ScaleTextBox" Text="1.0" Width="80" HorizontalAlignment="Right" Style="{StaticResource GlassTextBoxStyle}" Height="28" FontSize="12"/>
                </Grid>
                
                <Grid Margin="0,2">
                    <TextBlock Text="Output Size (mm)" VerticalAlignment="Center" Foreground="#CCFFFFFF" FontSize="12"/>
                    <TextBox x:Name="OutputSizeTextBox" Text="100" Width="80" HorizontalAlignment="Right" Style="{StaticResource GlassTextBoxStyle}" Height="28" FontSize="12"/>
                </Grid>

                <Button Content="Generate Preview" Height="40" Style="{StaticResource GlassButtonStyle}" Margin="0,10,0,10" Click="GenerateButton_Click"/>
                <Button Content="Export As STL" Height="40" Style="{StaticResource GlassButtonStyle}" Background="{StaticResource AccentBrush}" Click="ExportButton_Click"/>
                
                <TextBlock x:Name="StatusText" Text="" Foreground="#88FFFFFF" TextWrapping="Wrap" Margin="0,10,0,0"/>
            </StackPanel>
        </Border>

        <!-- Preview -->
        <Border Grid.Column="1" Margin="20" Style="{StaticResource GlassPanelStyle}">
            <helix:HelixViewport3D x:Name="viewport" ShowCoordinateSystem="True" Background="Transparent"
                                   CameraRotationMode="Turntable"
                                   ZoomExtentsWhenLoaded="True">
                <helix:HelixViewport3D.Camera>
                    <PerspectiveCamera Position="1000,1000,1000" LookDirection="-1,-1,-1" UpDirection="0,1,0" 
                                       NearPlaneDistance="0.1" FarPlaneDistance="100000" FieldOfView="45"/>
                </helix:HelixViewport3D.Camera>
                <helix:DefaultLights/>
                <ModelVisual3D x:Name="previewVisual"/>
            </helix:HelixViewport3D>
        </Border>
        
        <!-- Loading Overlay -->
        <Grid x:Name="LoadingOverlay" Grid.ColumnSpan="2" Background="#80000000" Visibility="Collapsed">
            <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center">
                <TextBlock Text="Loading Map Data..." Foreground="White" FontSize="18" HorizontalAlignment="Center"/>
                <ProgressBar IsIndeterminate="True" Width="200" Height="4" Margin="0,10,0,0"/>
            </StackPanel>
        </Grid>
    </Grid>
</UserControl>
